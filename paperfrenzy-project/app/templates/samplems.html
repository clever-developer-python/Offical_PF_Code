<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "qxotscsx2u");
    </script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-adsense-account" content="ca-pub-7186413258992386">
<title>PaperFrenzy - Marking Scheme</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
<meta name="monetag" content="9a1b5bd0718c47a3080137aed2a2f4a1">
<!-- Hotjar Tracking Code for https://www.paperfrenzy.in -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:5253975,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<style>
body {
    font-family: 'Inter', sans-serif;
}

:root {
    --color-white: #ffffff;
    --color-black: #000000;
    --br-9xs: 4px;
    --spacing-xs: 8px;
    --spacing-s: 16px;
    --spacing-m: 24px;
    --spacing-xl: 40px;
    --title-size: 40px;
    --subheading-size: 24px;
    --body-text-size: 18px;
    --button-text-size: 18px;
    --body-text: 'Inter', sans-serif;
    --button-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
}

.header-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: var(--color-white);
    width: 100%;
    height: 164px;
    padding: 0 80px;
    box-sizing: border-box;
    color: #000000;
}

.header-navigation .navbar {
    display: flex;
    width: 100%;
}

.header-navigation .navbar-brand {
    margin-right: auto; /* Pushes the brand to the left */
}

.header-navigation .navbar-collapse {
    margin-left: auto; /* Aligns the collapsible part to the right */
}

.header-navigation .navbar-nav {
    display: flex;
    margin-left: auto; /* Pushes the nav items to the right */
}

.header-navigation .navbar-nav .nav-item {
    margin-left: var(--spacing-xl); /* Adds spacing between nav items */
}

/* Ensure dropdowns align correctly */
.header-navigation .dropdown-menu {
    right: 0;
    left: auto; /* Override default left alignment */
}

.header-navigation .dropdown-toggle::after {
    display: none;
}

.items {
    display: flex;
    gap: var(--spacing-xl);
}

.items .dive-in {
    cursor: pointer;
    font-weight: 500;
    font-size: 1.25rem;
}

.viewer-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 0;
    margin-top: 10px;
    transition: all 0.3s ease;
    height: calc(100vh - 174px);
}

.viewer {
    width: 50%;
    transition: transform 0.3s ease;
    box-sizing: border-box;
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    position: relative;
}

.viewer.shift-left {
    transform: translateX(-2.5%);
}

#mark-scheme-viewer {
    display: none;
}

.pdf-container {
    width: 100%;
    position: relative;
}

.pdf-page-wrapper {
    position: relative;
    margin-bottom: 10px;
}

.editable-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.editable-content {
    position: absolute;
    background: transparent;
    font-family: Arial, sans-serif;
    font-size: 14px;
    color: blue;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    pointer-events: auto;
    box-sizing: border-box;
    border: none; /* Remove borders */
    outline: none; /* Remove outline on focus */
    padding: 0;
    margin: 0;
}

.editable-content:focus {
    border: none;
    outline: none; /* Remove outline on focus */
}

.scribble-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: auto; /* Ensure this canvas receives pointer events */
}

.paperfrenzy1 {
    font-weight: 500;
    font-size: 1.5rem;
    line-height: 150%;
}



/* Dropdown styles */
.dropdown {
    position: relative; /* Ensure positioning context for dropdown menu */
    display: inline-block;
}

.dropdown-menu {
    display: none; /* Hide by default */
    position: absolute;
    top: 100%;
    right: 0;
    left: auto; /* Override default left alignment */
    background-color: var(--color-white);
    box-shadow: var(--button-shadow);
    padding: var(--spacing-s) 0;
    z-index: 1050; /* Ensure it is above other content */
    min-width: 150px;
    width: max-content;
}

/* Ensure the dropdown menu appears when the dropdown is active */
.dropdown.show .dropdown-menu {
    display: block;
}

.dropdown-menu .dropdown-item {
    padding: var(--spacing-s);
    color: black;
    text-decoration: none;
    display: block;
    cursor: pointer;
}

.dropdown-menu .dropdown-item:hover {
    background-color: whitesmoke;
}

/* Ensure dropdown menu is above other content on mobile */
@media (max-width: 768px) {
    .dropdown-menu {
        position: fixed; /* Ensure it's positioned relative to the dropdown toggle */
        top: 164px; /* Position it directly below the dropdown toggle */
        right: 0;
        left: auto;
        width: 100%;
        max-width: 250px; /* Adjust as needed */
        height: auto;
        max-height: calc(100vh - 164px); /* Adjust based on header height */
        overflow-y: auto;
        z-index: 1060;
    }
}

.autocorrect-box {
    background-color: var(--color-white);
    border-radius: var(--br-9xs);
    padding: var(--spacing-m);
    max-width: 600px;
    margin: var(--spacing-xl) auto;
    display: none;
}

.autocorrect-input {
    width: calc(100% - 110px); /* Adjust based on button width */
    padding: var(--spacing-xs);
    font-size: var(--body-text-size);
    border: 1px solid #ccc;
    border-radius: var(--br-9xs);
    box-sizing: border-box;
}

.search-button {
    width: 100px;
    padding: var(--spacing-xs);
    font-size: var(--body-text-size);
    background-color: #007bff;
    color: var(--color-white);
    border: none;
    border-radius: var(--br-9xs);
    cursor: pointer;
}

.search-button:hover {
    background-color: #0056b3;
}

.autocorrect-message {
    margin-top: var(--spacing-m);
    font-size: var(--body-text-size);
}

@media screen and (max-width: 768px) {
    .viewer-container {
        flex-direction: column;
    }
    .viewer {
        width: 100%;
        height: auto;
        min-height: 100vh;
    }
    .viewer.shift-left {
        transform: none;
    }
    #mark-scheme-viewer {
        display: none;
    }
    .navbar {
        z-index: 1050;
    }
    .navbar-collapse {
        z-index: 1050; /* Same as navbar */
    }
    .dropdown-menu {
        z-index: 1060; /* Higher than the navbar */
    }
}

@media (max-width: 767.98px) {
    .header-navigation {
        padding: 0 20px;
    }
    
    .navbar {
        height: auto;
    }

    .navbar-nav {
        flex-direction: column;
        margin-left: 0; /* Remove margin for mobile view */
    }

    .navbar-nav .nav-item {
        margin-left: 0;
        margin-top: 0.5rem; /* Space between items */
    }
}

.loading-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    color: #555;
    z-index: 10;
    display: none; /* Hidden by default */
}
@media (max-width: 767.98px){
    #csstoggleid{
        display: none;
    }
}


</style>

</head>
<body>
    <div class="header-navigation">
        <nav class="navbar navbar-expand-md navbar-light bg-white">
            <a class="navbar-brand paperfrenzy1" href="/">PaperFrenzy</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item dive-in">
                        <a id="download-paper" class="nav-link" href="#">Download</a>
                    </li>
                   
                    <li class="nav-item dive-in dropdown" style="display: none;">
                        <a class="nav-link dropdown-toggle" href="#" id="openMarkSchemeDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Open Mark scheme
                        </a>
                        <div class="dropdown-menu" aria-labelledby="openMarkSchemeDropdown">
                            <a id="open-side-by-side" class="dropdown-item" href="#">Open side by side</a>
                            <a id="open-new-tab" class="dropdown-item" href="#">Open in new tab</a>
                        </div>
                    </li>
                   
                </ul>
            </div>
        </nav>
    </div>
    
    
    
<div class="viewer-container">
    <div class="loading-message" id="loading-message">Loading...</div>
    <div class="viewer" id="paper-viewer">
        <div class="pdf-container" id="paper-pdf-container"></div>
    </div>
    <div class="viewer" id="mark-scheme-viewer">
        <div class="loading-message" id="loading-message">Loading...</div>
        <div class="pdf-container" id="mark-scheme-pdf-container"></div>
    </div>
</div>


<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js';

let pdfInitialized = false; 
let renderedPages = new Set();
let lastWindowWidth = window.innerWidth;

$(document).ready(function() {
   $('[data-toggle="dropdown"]').dropdown();
});



document.querySelectorAll('.dropdown-toggle').forEach(function (toggle) {
   toggle.addEventListener('click', function () {
       var dropdown = this.closest('.dropdown');
       dropdown.classList.toggle('show');
   });
});

document.addEventListener('click', function (event) {
   if (!event.target.closest('.dropdown')) {
       document.querySelectorAll('.dropdown').forEach(function (dropdown) {
           dropdown.classList.remove('show');
       });
   }
});

$(document).ready(function() {
   $('#search-button').on('click', function() {
       const query = $('.autocorrect-input').val();
       document.getElementById("autocorrect-message").innerText = "Answering... Reply may take sometime depending on your internet";

       $.ajax({
           url: '/search/',
           type: 'POST',
           data: {
               'query': query,
               'csrfmiddlewaretoken': '{{ csrf_token }}'
           },
           success: function(response) {
               $('.autocorrect-message').text(response.message);
           },
           error: function(xhr, errmsg, err) {
               console.log(xhr.status + ": " + xhr.responseText);
           }
       });
   });
});



function renderPDF(url, containerId, forceRerender = false) {
   const container = document.getElementById(containerId);
   if (!container) return;

   const loadingMessage = document.getElementById('loading-message');
   
   renderedPages.clear();
   
   if (pdfInitialized && !forceRerender) return;

   container.innerHTML = '';
   if (loadingMessage) loadingMessage.style.display = 'block';

   pdfjsLib.getDocument(url).promise.then(function(pdf) {
       if (loadingMessage) loadingMessage.style.display = 'none';
       pdfInitialized = true;

       const renderPage = async function(pageNum) {
           if (renderedPages.has(pageNum)) return;
           
           try {
               const page = await pdf.getPage(pageNum);
               const viewport = page.getViewport({scale: 1});
               const containerWidth = container.clientWidth;
               const scale = containerWidth / viewport.width;
               const scaledViewport = page.getViewport({scale: scale});

               const wrapper = document.createElement('div');
               wrapper.className = 'pdf-page-wrapper';
               wrapper.setAttribute('data-page-number', pageNum);
               wrapper.style.width = `${scaledViewport.width}px`;
               wrapper.style.height = `${scaledViewport.height}px`;

               const canvas = document.createElement('canvas');
               const context = canvas.getContext('2d');
               canvas.height = scaledViewport.height;
               canvas.width = scaledViewport.width;

               const renderContext = {
                   canvasContext: context,
                   viewport: scaledViewport
               };

               await page.render(renderContext).promise;

               const editableLayer = document.createElement('div');
               editableLayer.className = 'editable-layer';

               const scribbleCanvas = document.createElement('canvas');
               scribbleCanvas.className = 'scribble-canvas';
               scribbleCanvas.width = canvas.width;
               scribbleCanvas.height = canvas.height;

          

               wrapper.appendChild(canvas);

               let inserted = false;
               const existingPages = container.querySelectorAll('.pdf-page-wrapper');
               for (let existing of existingPages) {
                   const existingNum = parseInt(existing.getAttribute('data-page-number'));
                   if (existingNum > pageNum) {
                       container.insertBefore(wrapper, existing);
                       inserted = true;
                       break;
                   }
               }
               if (!inserted) {
                   container.appendChild(wrapper);
               }

               renderedPages.add(pageNum);
               updateCanvasModes();

               canvas.addEventListener('click', function(event) {
                   setupEditableContent(canvas, editableLayer, event);
               });

           } catch (error) {
               console.error(`Error rendering page ${pageNum}:`, error);
           }
       };

       const renderPages = async () => {
           for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
               await renderPage(pageNum);
           }
       };

       renderPages();
   }).catch(function(error) {
       console.error('Error loading PDF:', error);
       if (loadingMessage) loadingMessage.style.display = 'none';
   });
}


// Debounce function
function debounce(func, wait) {
   let timeout;
   return function(...args) {
       clearTimeout(timeout);
       timeout = setTimeout(() => func.apply(this, args), wait);
   };
}

const handleResize = debounce(function() {
   const currentWidth = window.innerWidth;
   if (Math.abs(currentWidth - lastWindowWidth) > 50) {
       lastWindowWidth = currentWidth;
       renderPDF("{{ ms.0.file.url }}", 'paper-pdf-container', true);
   }
}, 250);

window.addEventListener('resize', handleResize);

document.addEventListener('DOMContentLoaded', function() {
   renderPDF("{{ ms.0.file.url }}", 'paper-pdf-container');

   document.getElementById('download-paper')?.addEventListener('click', async function(e) {
       e.preventDefault();
       
       const originalText = this.textContent;
       this.textContent = 'Downloading...';
       this.disabled = true;

       async function downloadPDF(url, filename) {
           try {
               const response = await fetch(url);
               if (!response.ok) throw new Error('Download failed');
               
               const blob = await response.blob();
               const blobUrl = window.URL.createObjectURL(blob);
               
               const iframe = document.createElement('iframe');
               iframe.style.display = 'none';
               document.body.appendChild(iframe);
               
               iframe.contentWindow.document.open();
               iframe.contentWindow.document.write(
                   `<a id="download" download="${filename}" href="${blobUrl}"></a>`
               );
               iframe.contentWindow.document.close();
               
               iframe.contentWindow.document.getElementById('download').click();
               
               setTimeout(() => {
                   document.body.removeChild(iframe);
                   window.URL.revokeObjectURL(blobUrl);
               }, 1000);
               
               return true;
           } catch (error) {
               console.error('Download error:', error);
               return false;
           }
       }

       try {
           await downloadPDF(
               "{{ ms.0.file.url }}", 
               '{{ ms.0.subject }}_MarkScheme.pdf'
           );
           await downloadPDF(
               "{{ papers.0.file.url }}", 
               '{{ papers.0.subject }}_Paper.pdf'
           );
       } catch (error) {
           alert('Download failed. Please try again.');
       } finally {
           this.textContent = originalText;
           this.disabled = false;
       }
   });

   const dropdownItems = document.querySelectorAll('.dropdown-menu .dropdown-item[data-mode]');
   dropdownItems.forEach(item => {
       item.addEventListener('click', function() {
           const mode = this.getAttribute('data-mode');
           if (mode) toggleMode(mode);
       });
   });

   // Prevent iOS double-tap zoom
   document.addEventListener('touchend', function(event) {
       const now = Date.now();
       const lastTap = $(event.target).data('lastTap') || now + 1;
       if (now - lastTap < 500) {
           event.preventDefault();
       }
       $(event.target).data('lastTap', now);
   });

   // Mobile navbar touch handling
   const navbar = document.querySelector('.navbar');
   if (navbar) {
       let touchStartY = 0;
       navbar.addEventListener('touchstart', function(e) {
           touchStartY = e.touches[0].clientY;
       }, { passive: true });

       navbar.addEventListener('touchmove', function(e) {
           const touchY = e.touches[0].clientY;
           const diff = touchStartY - touchY;

           if (Math.abs(diff) > 50) {
               navbar.style.transform = diff > 0 ? 'translateY(-100%)' : 'translateY(0)';
           }
       }, { passive: true });
   }
});

function updateMarkSchemeDropdown(isOpen) {
    const openSideBySideButton = document.getElementById('open-side-by-side');
    const openNewTabButton = document.getElementById('open-new-tab');
    const modeToggle = document.getElementById('modetoggle');
    const modalToggle = document.getElementById('modal-toggle');

    if (window.innerWidth <= 768) {
        if (openSideBySideButton) openSideBySideButton.style.display = 'none';
        if (modeToggle) modeToggle.style.display = 'none';
        if (modalToggle) modalToggle.style.display = 'none';
    } else {
        if (openSideBySideButton) openSideBySideButton.style.display = 'block';
        if (modeToggle) modeToggle.style.display = 'block';
        if (modalToggle) modalToggle.style.display = 'block';
    }
}

// Analytics events
function trackEvent(eventName, properties = {}) {
    try {
        if (window.usermaven) {
            window.usermaven('track', eventName, properties);
        }
    } catch (error) {
        console.error('Error tracking event:', error);
    }
}

// Performance monitoring
let renderStartTime;

function startRenderTimer() {
    renderStartTime = performance.now();
}

function endRenderTimer() {
    if (renderStartTime) {
        const renderTime = performance.now() - renderStartTime;
        trackEvent('PDF_RENDER_COMPLETE', { renderTime });
    }
}

// Error handling
window.onerror = function(msg, url, lineNo, columnNo, error) {
    console.error('Error: ', msg, url, lineNo, columnNo, error);
    trackEvent('JS_ERROR', {
        message: msg,
        url,
        lineNo,
        columnNo,
        errorStack: error?.stack
    });
    return false;
};

// Service worker registration
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').catch(function(err) {
            console.error('ServiceWorker registration failed:', err);
        });
    });
}
    </script>
    <script type="text/javascript"> var infolinks_pid = 3425180; var infolinks_wsid = 0; </script> <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCELWYKB3L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-ZCELWYKB3L');
    </script>
</body>
</html>

